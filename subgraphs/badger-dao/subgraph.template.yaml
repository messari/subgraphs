specVersion: 0.0.2
schema:
  file: ./schema.graphql
dataSources:
  {{#controllers}}
  - kind: ethereum/contract
    name: {{ name }}
    network: {{ chain }}
    source:
      address: "{{ address }}"
      abi: BadgerController
      startBlock: {{ startBlock }}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Token
        - RewardToken
        - YieldAggregator
        - UsageMetricsDailySnapshot
        - FinancialsDailySnapshot
        - VaultFee
        - Vault
        - VaultDailySnapshot
        - Deposit
        - Withdraw
        - _Strategy
        - _User
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: BadgerSett
          file: ./abis/BadgerSett.json
        - name: BadgerController
          file: ./abis/BadgerController.json
        - name: BadgerStrategy
          file: ./abis/BadgerStrategy.json
        - name: CalculationsCurve
          file: ./abis/CalculationsCurve.json
        - name: CalculationsSushi
          file: ./abis/CalculationsSushiSwap.json
      callHandlers:
        - function: setVault(address,address) 
          handler: handleSetVault
        - function: setStrategy(address,address) 
          handler: handleSetStrategy
      file: ./src/handlers/controller.ts
  {{/controllers}}

  {{#rewards}}
  - kind: ethereum/contract
    name: {{ name }}
    network: {{ chain }}
    source:
      address: "{{ address }}"
      abi: StakingRewards
      startBlock: {{ startBlock }}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Token
        - RewardToken
        - YieldAggregator
        - UsageMetricsDailySnapshot
        - FinancialsDailySnapshot
        - VaultFee
        - Vault
        - VaultDailySnapshot
        - Deposit
        - Withdraw
        - _Strategy
        - _User
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: BadgerSett
          file: ./abis/BadgerSett.json
        - name: BadgerController
          file: ./abis/BadgerController.json
        - name: BadgerStrategy
          file: ./abis/BadgerStrategy.json
        - name: CalculationsCurve
          file: ./abis/CalculationsCurve.json
        - name: CalculationsSushi
          file: ./abis/CalculationsSushiSwap.json
        - name: StakingRewards
          file: ./abis/StakingRewards.json
      eventHandlers:
        - event: RewardPaid(indexed address,uint256)
          handler: handleRewardPaid
        - event: RewardAdded(uint256)
          handler: handleRewardAdded
      file: ./src/handlers/reward.ts
  {{/rewards}}

# dynamic sett, created in controller.ts
templates:
  - kind: ethereum/contract
    name: SettVault
    network: {{ chain }}
    source:
      abi: BadgerSett
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Token
        - RewardToken
        - YieldAggregator
        - UsageMetricsDailySnapshot
        - FinancialsDailySnapshot
        - VaultFee
        - Vault
        - VaultDailySnapshot
        - Deposit
        - Withdraw
        - _Strategy
        - _User
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: BadgerSett
          file: ./abis/BadgerSett.json
        - name: BadgerController
          file: ./abis/BadgerController.json
        - name: BadgerStrategy
          file: ./abis/BadgerStrategy.json
        - name: CalculationsCurve
          file: ./abis/CalculationsCurve.json
        - name: CalculationsSushi
          file: ./abis/CalculationsSushiSwap.json
      callHandlers:
        - function: deposit(uint256)
          handler: handleDeposit
        - function: depositAll()
          handler: handleDepositAll
        - function: withdraw(uint256)
          handler: handleWithdraw
        - function: withdrawAll()
          handler: handleWithdrawAll
      file: ./src/handlers/vault.ts
  - kind: ethereum/contract
    name: BadgerStrategy
    network: {{ chain }}
    source:
      abi: BadgerStrategy
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - Token
        - RewardToken
        - YieldAggregator
        - UsageMetricsDailySnapshot
        - FinancialsDailySnapshot
        - VaultFee
        - Vault
        - VaultDailySnapshot
        - Deposit
        - Withdraw
        - _Strategy
        - _User
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: BadgerSett
          file: ./abis/BadgerSett.json
        - name: BadgerController
          file: ./abis/BadgerController.json
        - name: BadgerStrategy
          file: ./abis/BadgerStrategy.json
        - name: CalculationsCurve
          file: ./abis/CalculationsCurve.json
        - name: CalculationsSushi
          file: ./abis/CalculationsSushiSwap.json
      eventHandlers:
        - event: Harvest(uint256,indexed uint256)
          handler: handleHarvested
      callHandlers:
        - function: setPerformanceFee(uint256)
          handler: handleSetPerformanceFee
        - function: setWithdrawalFee(uint256)
          handler: handleSetWithdrawalFee
      file: ./src/handlers/strategy.ts 